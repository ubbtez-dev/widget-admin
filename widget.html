<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Widget</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;}
body{margin:0;background:#0e0e11;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Inter',sans-serif;}
.widget{width:440px;background:linear-gradient(180deg,#3f154f 0%,#2b0f36 55%,#260c30 100%);border-radius:18px;padding:22px 22px 16px;color:#fff;box-shadow:0 12px 40px rgba(0,0,0,0.55), inset 0 1px 0 rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.06);}
.header{display:flex;align-items:center;gap:14px;margin-bottom:18px;}
.badge{background:linear-gradient(180deg,#f2f2f2,#d9d9d9);color:#000;font-weight:800;font-size:11px;padding:6px 10px;border-radius:8px;letter-spacing:0.5px;box-shadow: inset 0 1px 2px rgba(0,0,0,0.15);}
.title{font-size:24px;font-weight:800;letter-spacing:1px;line-height:1;}
.subtitle{font-size:12px;font-weight:600;opacity:0.7;margin-top:4px;}
.stats{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding:12px 0;}
.stat{text-align:center;font-weight:700;letter-spacing:0.5px;display:flex;flex-direction:column;align-items:center;}
.stat .icon{font-size:32px;margin-bottom:4px;}
.stat span{font-size:13px;font-weight:600;opacity:0.9;}
.divider{width:1px;height:28px;background:rgba(255,255,255,0.12);margin:0 6px;}
.list{border-top:1px solid rgba(255,255,255,0.08);padding-top:14px;font-size:14px;max-height:400px;overflow:hidden;}
.item{display:flex;justify-content:space-between;padding:6px 0;font-weight:600;letter-spacing:0.3px;}
.item span:first-child{opacity:0.95;}
.item span:last-child{opacity:0.95;}
.highlight{color:#ffd76a;text-shadow:0 0 6px rgba(255,215,106,0.25);}
.activeBonus{color:#ffb347;}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
<div class="widget">
  <div class="header">
    <div class="badge" id="badge">BONUS</div>
    <div>
      <div class="title" id="eventTitle">EVENT #0</div>
      <div class="subtitle" id="streamerName">Streamer</div>
    </div>
  </div>
  <div class="stats">
    <div class="stat"><div class="icon">üí∞</div><span id="totalSpent">$0</span></div>
    <div class="divider"></div>
    <div class="stat"><div class="icon">‚ùå</div><span id="lossRatio">0x</span></div>
    <div class="divider"></div>
    <div class="stat"><div class="icon">‚≠ê</div><span id="bonusCount">0/0</span></div>
  </div>
  <div class="list" id="bonusList"></div>
</div>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyAvA5CAcKwuuHC2Cl8KlUbnkR9BJfp_9pw",
  authDomain:"adminwidget-b69c9.firebaseapp.com",
  databaseURL:"https://adminwidget-b69c9-default-rtdb.firebaseio.com",
  projectId:"adminwidget-b69c9",
  storageBucket:"adminwidget-b69c9.appspot.com",
  messagingSenderId:"585800098669",
  appId:"1:585800098669:web:65fd476b2e6eb55fe73064"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// –ë–µ—Ä—ë–º eventKey –∏–∑ URL: widget.html?event=bonusbuy_252
const params = new URLSearchParams(window.location.search);
const eventKey = params.get('event') || 'bonusbuy_252';

db.ref('events/' + eventKey).on('value', snapshot => {
  const data = snapshot.val();
  if(!data) return;

  const currency = data.currency || '$';

  // –¢–∏–ø —Å–æ–±—ã—Ç–∏—è –∏ –Ω–æ–º–µ—Ä
  const eventType = (data.eventType || 'BONUS').toUpperCase();
  document.getElementById('badge').textContent = eventType;
  document.getElementById('eventTitle').textContent = eventType + ' #' + (data.eventNumber || '0');
  document.getElementById('streamerName').textContent = data.streamerName || 'Streamer';

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  const totalSpent = data.totalSpent || 0;
  const totalWin = (data.bonuses || []).reduce((sum,b)=>sum+(b.win||0),0);
  const opened = (data.bonuses || []).filter(b=>b.opened).length;
  const totalCount = (data.bonuses || []).length;

  document.getElementById('totalSpent').textContent = currency + totalSpent.toLocaleString();
  document.getElementById('lossRatio').textContent = totalSpent>0 ? (totalWin/totalSpent).toFixed(2)+'x' : '0x';
  document.getElementById('bonusCount').textContent = opened + "/" + totalCount;

  const listEl = document.getElementById('bonusList');
  listEl.innerHTML = '';

  if(!data.bonuses) return;

  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å (highlight)
  const maxBonus = data.bonuses.reduce((max,b) => b.win > (max.win||0) ? b : max, {});
  const remaining = data.bonuses.filter(b => b !== maxBonus);

  if(maxBonus && maxBonus.win > 0){
    const div = document.createElement('div');
    div.className = 'item highlight';
    const nameShort = maxBonus.name.length>15 ? maxBonus.name.slice(0,15)+'‚Ä¶' : maxBonus.name;
    div.innerHTML = `<span>${nameShort} (${currency}${(maxBonus.cost||0).toLocaleString()})</span><span>${currency}${(maxBonus.win||0).toLocaleString()}</span>`;
    listEl.appendChild(div);

    const separator = document.createElement('div');
    separator.style.borderTop='1px solid rgba(255,255,255,0.08)';
    separator.style.margin='6px 0';
    listEl.appendChild(separator);
  }

  // –û—Å—Ç–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã –≤ –ø–æ—Ä—è–¥–∫–µ –∏–∑ –∞–¥–º–∏–Ω–∫–∏ —Å –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π
  let activeSet = false;
  remaining.forEach((b, i) => {
    const div = document.createElement('div');
    const isActive = !b.opened && !activeSet;
    if(isActive) activeSet = true;
    div.className = 'item' + (isActive ? ' activeBonus' : '');
    const nameShort = b.name.length>15 ? b.name.slice(0,15)+'‚Ä¶' : b.name;
    div.innerHTML = `<span>${i+1}. ${nameShort} (${currency}${(b.cost||0).toLocaleString()})</span><span>${b.win>0 ? currency+(b.win||0).toLocaleString() : '-'}</span>`;
    listEl.appendChild(div);
  });
});
</script>
</body>
</html>
