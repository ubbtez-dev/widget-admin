<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ADMIN PANEL - UBTEZ</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
body{
  margin:0;
  background:#0e0e11;
  font-family:'Inter',sans-serif;
  display:flex;
  justify-content:center;
  padding:40px 20px;
  color:#fff;
}

.panel{
  width:900px;
  background:linear-gradient(180deg,#3f154f 0%,#2b0f36 55%,#260c30 100%);
  padding:30px;
  border-radius:20px;
  border:1px solid rgba(255,255,255,.06);
}

h1{
  text-align:center;
  margin-bottom:30px;
}

input, select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.1);
  background:#1a1221;
  color:#fff;
  margin-bottom:15px;
}

button{
  background:#ffd76a;
  border:none;
  padding:10px 16px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
  margin-bottom:15px;
}

.bonus{
  background:rgba(255,255,255,.03);
  padding:12px;
  border-radius:12px;
  margin-bottom:10px;
}

.row{
  display:flex;
  gap:10px;
}

.small{
  flex:1;
}
</style>
</head>
<body>

<div class="panel">

<h1>ADMIN PANEL - UBTEZ</h1>

<label>Тип события</label>
<select id="eventType">
  <option value="bonusbuy">BONUSBUY</option>
  <option value="bonushunt">BONUSHUNT</option>
</select>

<label>Номер события</label>
<input type="number" id="eventNumber" placeholder="300">

<label>Общая сумма трат (₽)</label>
<input type="number" id="totalSpent" placeholder="0">

<h3>Бонусы</h3>
<div id="bonusList"></div>

<button onclick="addBonus()">Добавить слот</button>

</div>

<script>

firebase.initializeApp({
  apiKey:"AIzaSyAvA5CAcKwuuHC2Cl8KlUbnkR9BJfp_9pw",
  authDomain:"adminwidget-b69c9.firebaseapp.com",
  databaseURL:"https://adminwidget-b69c9-default-rtdb.firebaseio.com",
  projectId:"adminwidget-b69c9"
});

const db = firebase.database();
const ref = db.ref("events/ubtez_current");

let bonuses = [];

function save(){

  const totalWin = bonuses.reduce((s,b)=>s+(b.win||0),0);

  ref.set({
    streamerName:"ubtez",
    eventType:document.getElementById("eventType").value,
    eventNumber:Number(document.getElementById("eventNumber").value||0),
    totalSpent:Number(document.getElementById("totalSpent").value||0),
    totalWin:totalWin,
    bonuses:bonuses
  });

}

function render(){

  const list = document.getElementById("bonusList");
  list.innerHTML="";

  bonuses.forEach((b,i)=>{

    const div = document.createElement("div");
    div.className="bonus";

    div.innerHTML=`
      <div class="row">
        <input class="small" placeholder="Название"
          value="${b.name||''}"
          onchange="updateName(${i},this.value)">
      </div>

      <div class="row">
        <input class="small" type="number" placeholder="Покупка ₽"
          value="${b.cost||0}"
          onchange="updateCost(${i},this.value)">

        <input class="small" type="number" placeholder="Выигрыш ₽"
          value="${b.win||0}"
          onchange="updateWin(${i},this.value)">
      </div>

      <div class="row">
        <button onclick="toggle(${i})">
          ${b.opened ? "ОТКРЫТ" : "ЗАКРЫТ"}
        </button>

        <button onclick="removeBonus(${i})">Удалить</button>
      </div>
    `;

    list.appendChild(div);

  });

  save();
}

function addBonus(){
  bonuses.push({
    name:"",
    cost:0,
    win:0,
    opened:false
  });
  render();
}

function removeBonus(i){
  bonuses.splice(i,1);
  render();
}

function toggle(i){
  bonuses[i].opened = !bonuses[i].opened;
  render();
}

function updateName(i,val){
  bonuses[i].name = val;
  save();
}

function updateCost(i,val){
  bonuses[i].cost = Number(val||0);
  save();
}

function updateWin(i,val){
  bonuses[i].win = Number(val||0);
  save();
}

/* Подгружаем данные при открытии */

ref.on("value",snap=>{
  const data = snap.val();
  if(!data) return;

  document.getElementById("eventType").value = data.eventType || "bonusbuy";
  document.getElementById("eventNumber").value = data.eventNumber || 0;
  document.getElementById("totalSpent").value = data.totalSpent || 0;

  bonuses = data.bonuses || [];
  render();
});

</script>
</body>
</html>
